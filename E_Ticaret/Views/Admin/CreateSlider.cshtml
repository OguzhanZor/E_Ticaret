@model E_Ticaret.Models.Slider
@{
    ViewData["Title"] = "Yeni Slider";
    Layout = "~/Views/Admin/Shared/_Layout.cshtml";
}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="h3 mb-0">Yeni Slider</h1>
    <a href="@Url.Action("Sliders", "Admin")" class="btn btn-outline-secondary">
        <i class="material-icons md-arrow_back"></i> Geri Dön
    </a>
</div>

<div class="card">
    <div class="card-body">
        <form asp-action="CreateSlider" method="post" enctype="multipart/form-data">
            <input asp-for="ImageUrl" type="hidden" />
            <input asp-for="MobileImageUrl" type="hidden" />
            <div class="row">
                <div class="col-md-8">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="Title" class="form-label">Başlık *</label>
                                <input asp-for="Title" class="form-control" />
                                <span asp-validation-for="Title" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="DisplayOrder" class="form-label">Görüntü Sırası</label>
                                <input asp-for="DisplayOrder" class="form-control" type="number" min="0" />
                                <span asp-validation-for="DisplayOrder" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label asp-for="Subtitle" class="form-label">Alt Başlık</label>
                        <textarea asp-for="Subtitle" class="form-control" rows="2"></textarea>
                        <span asp-validation-for="Subtitle" class="text-danger"></span>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="ButtonText" class="form-label">Buton Metni</label>
                                <input asp-for="ButtonText" class="form-control" />
                                <span asp-validation-for="ButtonText" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="ButtonUrl" class="form-label">Buton Linki</label>
                                <input asp-for="ButtonUrl" class="form-control" />
                                <span asp-validation-for="ButtonUrl" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="StartDate" class="form-label">Başlangıç Tarihi *</label>
                                <input asp-for="StartDate" class="form-control" type="date" />
                                <span asp-validation-for="StartDate" class="text-danger"></span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label asp-for="EndDate" class="form-label">Bitiş Tarihi</label>
                                <input asp-for="EndDate" class="form-control" type="date" />
                                <span asp-validation-for="EndDate" class="text-danger"></span>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                            <label asp-for="IsActive" class="form-check-label">Aktif</label>
                        </div>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="mb-3">
                        <label class="form-label">Arkaplan Görseli *</label>
                        <div class="image-upload-container">
                            <div class="image-preview" id="sliderImagePreview">
                                <i class="material-icons md-image text-muted"></i>
                                <span>Görsel yükleyin</span>
                            </div>
                            <input type="file" name="imageFile" id="sliderImageInput" class="form-control d-none" accept="image/*" />
                            <div class="text-center mt-2">
                                <button type="button" class="btn btn-outline-primary btn-sm" onclick="document.getElementById('sliderImageInput').click()">
                                    <i class="material-icons md-upload"></i> Görsel Seç
                                </button>
                            </div>
                        </div>
                        <div id="imageValidation" class="text-danger" style="display: none;">Lütfen bir görsel seçin</div>
                        <span asp-validation-for="ImageUrl" class="text-danger"></span>
                        <small class="form-text text-muted">Önerilen boyut: 1920x600px</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Mobil Görsel</label>
                        <div class="image-upload-container">
                            <div class="image-preview" id="mobileSliderImagePreview">
                                <i class="material-icons md-image text-muted"></i>
                                <span>Mobil görsel yükleyin</span>
                            </div>
                            <input type="file" name="mobileImageFile" id="mobileSliderImageInput" class="form-control d-none" accept="image/*" />
                            <div class="text-center mt-2">
                                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="document.getElementById('mobileSliderImageInput').click()">
                                    <i class="material-icons md-upload"></i> Mobil Görsel Seç
                                </button>
                            </div>
                        </div>
                        <span asp-validation-for="MobileImageUrl" class="text-danger"></span>
                        <small class="form-text text-muted">Önerilen boyut: 768x400px</small>
                    </div>
                </div>
            </div>

            <div class="d-flex justify-content-end gap-2">
                <a href="@Url.Action("Sliders", "Admin")" class="btn btn-secondary">İptal</a>
                <button type="submit" class="btn btn-primary">
                    <i class="material-icons md-save"></i> Kaydet
                </button>
            </div>
        </form>
    </div>
</div>

@section Styles {
    <style>
        .image-upload-container { position: relative; }
        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 10px;
        }
        .image-preview:hover { border-color: #007bff; background-color: #f0f8ff; }
        .image-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 6px; }
        .image-preview.has-image { border-style: solid; border-color: #28a745; }
        .image-preview i { font-size: 3rem; margin-bottom: 10px; }
        .image-preview span { color: #6c757d; font-size: 0.9rem; }
    </style>
}

@section Scripts {
    <script>
        (function() {
            let hasMainImage = false;
            let hasMobileImage = false;

            function setupImageUpload(previewSelector, fileInputSelector, hiddenFieldSelector, isMainImage = false) {
                const preview = document.querySelector(previewSelector);
                const fileInput = document.querySelector(fileInputSelector);
                const hiddenField = document.querySelector(hiddenFieldSelector);

                preview.addEventListener('click', function() {
                    fileInput.click();
                });

                fileInput.addEventListener('change', function() {
                    const file = this.files && this.files[0];
                    if (!file) {
                        if (isMainImage) {
                            hasMainImage = false;
                            document.getElementById('imageValidation').style.display = 'block';
                        }
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        preview.innerHTML = '<img src="' + e.target.result + '" alt="Preview" />';
                        preview.classList.add('has-image');
                        
                        // Hidden field'a geçici değer ata (controller'da gerçek dosya yolu ile değiştirilecek)
                        hiddenField.value = 'temp_' + Date.now();
                        
                        if (isMainImage) {
                            hasMainImage = true;
                            document.getElementById('imageValidation').style.display = 'none';
                        } else {
                            hasMobileImage = true;
                        }
                    };
                    reader.readAsDataURL(file);
                });
            }

            // Form submit validation
            document.querySelector('form').addEventListener('submit', function(e) {
                if (!hasMainImage) {
                    e.preventDefault();
                    document.getElementById('imageValidation').style.display = 'block';
                    document.getElementById('imageValidation').scrollIntoView({ behavior: 'smooth' });
                    return false;
                }
            });

            setupImageUpload('#sliderImagePreview', '#sliderImageInput', 'input[name="ImageUrl"]', true);
            setupImageUpload('#mobileSliderImagePreview', '#mobileSliderImageInput', 'input[name="MobileImageUrl"]', false);
        })();
    </script>
}


